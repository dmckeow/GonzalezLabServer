ClusterName=slurm

SlurmctldHost=slurm-controller
SlurmctldHost=slurm-controller-bk

SrunPortRange=60001-63000

AuthType=auth/munge
CryptoType=crypto/munge
MailProg=/usr/bin/mail
MpiDefault=none
PrivateData=accounts,reservations
ProctrackType=proctrack/cgroup
PropagateResourceLimitsExcept=ALL
# un noeud quitte l'état DOWN dès qu'il a une configuration valide (default=1)
ReturnToService=2
SlurmctldPidFile=/var/run/slurmctld.pid
SlurmctldPort=6817
SlurmdPort=6818
SlurmdSpoolDir=/var/spool/slurm/slurmd
SlurmUser=slurm
SlurmdUser=root
StateSaveLocation=/mnt/slurm-swap/spool/slurm/state
SwitchType=switch/none
TaskPlugin=task/cgroup,task/affinity
InactiveLimit=0
KillWait=30
# Kill job timeout (if exceeded, the compute node will be drained)
UnkillableStepTimeout=180

# temps de conservation des jobs en file après execution
MinJobAge=300
SlurmctldTimeout=120
SlurmdTimeout=300

# temps que srun attend avant de terminer les tâches secondaires après que la tâche principale se soit arrêtée
Waittime=0
SchedulerType=sched/backfill


# les ressources sont considérées comme des consommables
SelectType=select/cons_res

SelectTypeParameters=CR_CPU_Memory

MaxJobCount=100001
MaxArraySize=10001
PriorityType=priority/multifactor
PriorityWeightAge=6000000
PriorityWeightFairShare=10000000
PriorityWeightJobSize=5000000
PriorityWeightPartition=10000000
PriorityWeightQOS=0

AccountingStorageEnforce=limits
AccountingStorageHost=192.168.1.35
AccountingStoragePort=6819
AccountingStorageType=accounting_storage/slurmdbd
AccountingStorageUser=root
AccountingStoreFlags=job_comment
DebugFlags=NO_CONF_HASH
# none car stockage des données dans slurmdbd
JobCompType=jobcomp/none
JobAcctGatherFrequency=30
JobAcctGatherType=jobacct_gather/cgroup
SlurmctldDebug=debug
SlurmctldLogFile=/var/log/slurm//slurmctld.log
SlurmSchedLogFile=/var/log/slurm//sched.log
SlurmSchedLogLevel=1
SlurmdDebug=info
SlurmdLogFile=/var/log/slurm//slurmd.log
DefMemPerCPU=2000
FirstJobId=20529727

HealthCheckInterval=600
HealthCheckProgram="/etc/slurm/healthcheck.sh"

Prolog=/etc/slurm/prolog
Epilog=/etc/slurm/epilog
TaskProlog=/etc/slurm/taskprolog
TaskEpilog=/etc/slurm/taskepilog

AccountingStorageTRES=gres/gpu
GresTypes=gpu

SlurmdParameters=config_overrides       # can we remove this ?

NodeName=slurm-controller State=UNKNOWN

NodeName=cpu-node-041 RealMemory=257000 Sockets=2 CoresPerSocket=12 ThreadsPerCore=2 MemSpecLimit=4096 CoreSpecCount=1 Weight=20 Features=intel,haswell State=UNKNOWN
NodeName=cpu-node-044 RealMemory=257000 Sockets=2 CoresPerSocket=12 ThreadsPerCore=2 MemSpecLimit=4096 CoreSpecCount=1 Weight=20 Features=intel,haswell State=UNKNOWN
NodeName=cpu-node-045 RealMemory=257000 Sockets=2 CoresPerSocket=12 ThreadsPerCore=2 MemSpecLimit=4096 CoreSpecCount=1 Weight=20 Features=intel,broadwell State=UNKNOWN
NodeName=cpu-node-046 RealMemory=257000 Sockets=2 CoresPerSocket=12 ThreadsPerCore=2 MemSpecLimit=4096 CoreSpecCount=1 Weight=20 Features=intel,broadwell State=UNKNOWN
NodeName=cpu-node-047 RealMemory=257000 Sockets=2 CoresPerSocket=12 ThreadsPerCore=2 MemSpecLimit=4096 CoreSpecCount=1 Weight=20 Features=intel,broadwell State=UNKNOWN
NodeName=cpu-node-048 RealMemory=257000 Sockets=2 CoresPerSocket=12 ThreadsPerCore=2 MemSpecLimit=4096 CoreSpecCount=1 Weight=20 Features=intel,broadwell State=UNKNOWN
NodeName=cpu-node-050 RealMemory=257000 Sockets=2 CoresPerSocket=64 ThreadsPerCore=2 MemSpecLimit=4096 CoreSpecCount=1 Weight=1 Features=amd,epyc_rome State=UNKNOWN
NodeName=cpu-node-051 RealMemory=257000 Sockets=2 CoresPerSocket=64 ThreadsPerCore=2 MemSpecLimit=4096 CoreSpecCount=1 Weight=1 Features=amd,epyc_rome State=UNKNOWN
NodeName=cpu-node-052 RealMemory=257000 Sockets=2 CoresPerSocket=64 ThreadsPerCore=2 MemSpecLimit=4096 CoreSpecCount=1 Weight=1 Features=amd,epyc_rome State=UNKNOWN
NodeName=cpu-node-053 RealMemory=257000 Sockets=2 CoresPerSocket=64 ThreadsPerCore=2 MemSpecLimit=4096 CoreSpecCount=1 Weight=1 Features=amd,epyc_rome State=UNKNOWN
NodeName=cpu-node-054 RealMemory=257000 Sockets=2 CoresPerSocket=24 ThreadsPerCore=2 MemSpecLimit=4096 CoreSpecCount=1 Weight=1 Features=amd,epyc_rome State=UNKNOWN
NodeName=cpu-node-055 RealMemory=257000 Sockets=2 CoresPerSocket=24 ThreadsPerCore=2 MemSpecLimit=4096 CoreSpecCount=1 Weight=1 Features=amd,epyc_rome State=UNKNOWN
NodeName=cpu-node-056 RealMemory=257000 Sockets=2 CoresPerSocket=24 ThreadsPerCore=2 MemSpecLimit=4096 CoreSpecCount=1 Weight=1 Features=amd,epyc_rome State=UNKNOWN
NodeName=cpu-node-057 RealMemory=257000 Sockets=2 CoresPerSocket=24 ThreadsPerCore=2 MemSpecLimit=4096 CoreSpecCount=1 Weight=1 Features=amd,epyc_rome State=UNKNOWN
NodeName=cpu-node-058 RealMemory=257000 Sockets=2 CoresPerSocket=24 ThreadsPerCore=2 MemSpecLimit=4096 CoreSpecCount=1 Weight=1 Features=amd,epyc_rome State=UNKNOWN
NodeName=cpu-node-059 RealMemory=257000 Sockets=2 CoresPerSocket=24 ThreadsPerCore=2 MemSpecLimit=4096 CoreSpecCount=1 Weight=1 Features=amd,epyc_rome State=UNKNOWN
NodeName=cpu-node-060 RealMemory=257000 Sockets=2 CoresPerSocket=24 ThreadsPerCore=2 MemSpecLimit=4096 CoreSpecCount=1 Weight=1 Features=amd,epyc_rome State=UNKNOWN
NodeName=cpu-node-061 RealMemory=257000 Sockets=2 CoresPerSocket=24 ThreadsPerCore=2 MemSpecLimit=4096 CoreSpecCount=1 Weight=1 Features=amd,epyc_rome State=UNKNOWN
NodeName=cpu-node-064 RealMemory=1000000 Sockets=2 CoresPerSocket=26 ThreadsPerCore=2 MemSpecLimit=4096 CoreSpecCount=1 Weight=1 Features=intel,ice_lake State=UNKNOWN
NodeName=cpu-node-065 RealMemory=1000000 Sockets=2 CoresPerSocket=26 ThreadsPerCore=2 MemSpecLimit=4096 CoreSpecCount=1 Weight=1 Features=intel,ice_lake State=UNKNOWN
NodeName=cpu-node-066 RealMemory=1000000 Sockets=2 CoresPerSocket=26 ThreadsPerCore=2 MemSpecLimit=4096 CoreSpecCount=1 Weight=1 Features=intel,ice_lake State=UNKNOWN
NodeName=cpu-node-067 RealMemory=1000000 Sockets=2 CoresPerSocket=26 ThreadsPerCore=2 MemSpecLimit=4096 CoreSpecCount=1 Weight=1 Features=intel,ice_lake State=UNKNOWN
NodeName=cpu-node-068 RealMemory=1000000 Sockets=2 CoresPerSocket=26 ThreadsPerCore=2 MemSpecLimit=4096 CoreSpecCount=1 Weight=1 Features=intel,ice_lake State=UNKNOWN
NodeName=cpu-node-069 RealMemory=1000000 Sockets=2 CoresPerSocket=26 ThreadsPerCore=2 MemSpecLimit=4096 CoreSpecCount=1 Weight=1 Features=intel,ice_lake State=UNKNOWN
NodeName=cpu-node-070 RealMemory=1500000 Sockets=2 CoresPerSocket=128 ThreadsPerCore=2 MemSpecLimit=4096 CoreSpecCount=1 Weight=1 Features=amd,epyc_bergamo State=UNKNOWN
NodeName=cpu-node-071 RealMemory=1500000 Sockets=2 CoresPerSocket=128 ThreadsPerCore=2 MemSpecLimit=4096 CoreSpecCount=1 Weight=1 Features=amd,epyc_bergamo State=UNKNOWN
NodeName=cpu-node-072 RealMemory=1500000 Sockets=2 CoresPerSocket=128 ThreadsPerCore=2 MemSpecLimit=4096 CoreSpecCount=1 Weight=1 Features=amd,epyc_bergamo State=UNKNOWN
NodeName=cpu-node-073 RealMemory=1500000 Sockets=2 CoresPerSocket=128 ThreadsPerCore=2 MemSpecLimit=4096 CoreSpecCount=1 Weight=1 Features=amd,epyc_bergamo State=UNKNOWN
NodeName=cpu-node-074 RealMemory=1500000 Sockets=2 CoresPerSocket=128 ThreadsPerCore=2 MemSpecLimit=4096 CoreSpecCount=1 Weight=1 Features=amd,epyc_bergamo State=UNKNOWN
NodeName=cpu-node-075 RealMemory=1500000 Sockets=2 CoresPerSocket=128 ThreadsPerCore=2 MemSpecLimit=4096 CoreSpecCount=1 Weight=1 Features=amd,epyc_bergamo State=UNKNOWN
NodeName=cpu-node-076 RealMemory=1500000 Sockets=2 CoresPerSocket=128 ThreadsPerCore=2 MemSpecLimit=4096 CoreSpecCount=1 Weight=1 Features=amd,epyc_bergamo State=UNKNOWN
NodeName=cpu-node-077 RealMemory=1500000 Sockets=2 CoresPerSocket=128 ThreadsPerCore=2 MemSpecLimit=4096 CoreSpecCount=1 Weight=1 Features=amd,epyc_bergamo State=UNKNOWN
NodeName=cpu-node-049 RealMemory=2064000 Sockets=4 CoresPerSocket=16 ThreadsPerCore=2 MemSpecLimit=4096 CoreSpecCount=1 Weight=20 Features=intel,broadwell,avx2 State=UNKNOWN
NodeName=cpu-node-062 RealMemory=1000000 Sockets=2 CoresPerSocket=26 ThreadsPerCore=2 MemSpecLimit=4096 CoreSpecCount=1 Weight=5 Features=intel,ice_lake State=UNKNOWN
NodeName=cpu-node-063 RealMemory=1000000 Sockets=2 CoresPerSocket=26 ThreadsPerCore=2 MemSpecLimit=4096 CoreSpecCount=1 Weight=5 Features=intel,ice_lake State=UNKNOWN
NodeName=gpu-node-01 RealMemory=128000 Sockets=2 CoresPerSocket=10 ThreadsPerCore=2 MemSpecLimit=4096 CoreSpecCount=1 Weight=30 Gres=gpu:k80:2 Features=intel,broadwell,avx2 State=UNKNOWN
NodeName=gpu-node-02 RealMemory=500000 Sockets=2 CoresPerSocket=20 ThreadsPerCore=2 MemSpecLimit=4096 CoreSpecCount=1 Weight=20 Gres=gpu:l40s:2 Features=intel,sapphire-rapids,alphafold State=UNKNOWN
NodeName=gpu-node-03 RealMemory=500000 Sockets=2 CoresPerSocket=20 ThreadsPerCore=2 MemSpecLimit=4096 CoreSpecCount=1 Weight=20 Gres=gpu:l40s:2 Features=intel,sapphire-rapids,alphafold State=UNKNOWN

PartitionName=fast Nodes="cpu-node-[044-048,050-067,070-077],gpu-node-01" Default=True MaxTime=1-00:00:00 AllowAccounts=ALL State=UP
PartitionName=long Nodes="cpu-node-[041,044-048,051-067,070-077]" Default=False MaxTime=30-00:00:00 AllowAccounts=ALL State=UP
PartitionName=bigmem Nodes="cpu-node-[049,068-069]" Default=False MaxTime=60-00:00:00 AllowAccounts=ALL State=UP
PartitionName=gpu Nodes="gpu-node-[01-03]" Default=False MaxTime=10-00:00:00 AllowAccounts=ALL State=UP
